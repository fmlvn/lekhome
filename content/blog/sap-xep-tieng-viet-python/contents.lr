title: S·∫Øp x·∫øp (sort) string Ti·∫øng Vi·ªát
---
author: HVN
---
body:

M·ªôt v·∫•n ƒë·ªÅ kh√¥ng h·ªÅ m·ªõi, x∆∞a nh∆∞ nƒÉm 1991, v√† c√≥ v·∫ª ƒë√¢u ƒë√≥ ƒë√£ ƒë∆∞·ª£c gi·∫£i quy·∫øt üòí

V·∫≠y nh∆∞ng n·∫øu th·ª≠ h·ªèi m·ªôt l·∫≠p tr√¨nh vi√™n s·ª≠ d·ª•ng ng√¥n ng·ªØ l·∫≠p tr√¨nh b·∫•t k·ª≥ h√£y
vi·∫øt m·ªôt ƒëo·∫°n code s·∫Øp x·∫øp nh·ªØng c√°i t√™n sau theo th·ª© t·ª± c·ªßa ti·∫øng Vi·ªát:

```python
In [14]: provinces = ['H·∫£i D∆∞∆°ng',
    ...:  'H∆∞ng Y√™n',
    ...:  'H√† N·ªôi',
    ...:  'H·∫£i Ph√≤ng',
    ...:  'H·∫≠u Giang',
    ...:  'H√≤a B√¨nh',
    ...:  'H√† Nam',
    ...:  'H√† Giang',
    ...:  'H√† Tƒ©nh']
```

K·∫øt qu·∫£ thu ƒë∆∞·ª£c s·∫Ω kh√° b·∫•t ng·ªù:

```Python
In [15]: sorted(provinces)
Out[15]:
['H√† Giang',
 'H√† Nam',
 'H√† N·ªôi',
 'H√† Tƒ©nh',
 'H√≤a B√¨nh',
 'H∆∞ng Y√™n',
 'H·∫£i D∆∞∆°ng',
 'H·∫£i Ph√≤ng',
 'H·∫≠u Giang']
```

L·∫Ω ra, th·ª© m√† ch√∫ng ta mu·ªën nh√¨n th·∫•y ph·∫£i l√† "H∆∞ng Y√™n" ƒë·ª©ng cu·ªëi list, khi m√† ch·ªØ "∆∞" ƒë·ª©ng sau t·∫•t c·∫£ c√°c ph·ª• √¢m kh√°c.

V·∫≠y function `sorted` c√≥ bug?

H√£y th·ª≠ xem codepoint c·ªßa t·ª´ng ch·ªØ c√°i th·ª© 2 trong m·ªói t·ª´:

```Python
In [19]: [(s[1], ord(s[1])) for s in sorted(provinces)]
Out[19]:
[('√†', 224),
 ('√†', 224),
 ('√†', 224),
 ('√†', 224),
 ('√≤', 242),
 ('∆∞', 432),
 ('·∫£', 7843),
 ('·∫£', 7843),
 ('·∫≠', 7853)]
```

V·∫≠y `sorted` ho√†n to√†n kh√¥ng sai, n√≥ s·∫Øp x·∫øp c√°c ch·ªØ c√°i theo th·ª© t·ª± c√°c xu·∫•t hi·ªán trong b·∫£ng m√£ Unicode (codepoint). Ch·ªØ "∆∞" n·∫±m ·ªü v·ªã tr√≠ 432, ƒë·ª©ng tr∆∞·ªõc ch·ªØ "·∫≠" v·ªõi v·ªã tr√≠ 7853.

`sorted` ƒë√£ ƒë√∫ng, nh∆∞ng ƒë√¢y kh√¥ng ph·∫£i c√°ch s·∫Øp x·∫øp ch√∫ng ta mong mu·ªën.

V·∫≠y ƒëi·ªÅu g√¨ ·∫£nh h∆∞·ªüng ƒë·∫øn th·ª© t·ª± khi s·∫Øp x·∫øp c·ªßa c√°c ch·ªØ c√°i?
R√µ r√†ng n·∫øu theo chu·∫©n c·ªßa ng∆∞·ªùi M·ªπ, ng∆∞·ªùi ta s·∫Ω s·∫Øp x·∫øp nh∆∞ tr√™n, nh∆∞ng trong b·∫£ng ch·ªØ c√°i ti·∫øng Vi·ªát, th·ª© t·ª± l·∫°i kh√°c. Nh·ªØng th·ª© li√™n quan ƒë·∫øn ng√¥n ng·ªØ ƒë·ªãa ph∆∞∆°ng nh∆∞ v·∫≠y ƒë∆∞·ª£c bi·ªÉu di·ªÖn l√™n m√°y t√≠nh b·∫±ng kh√°i ni·ªám "locale".

# Locale l√† g√¨ /l…ô äÀàk…ëÀêl/
- English: a place where something happens or is set, or that has particular events associated with it
- Vietnamese: m·ªôi n∆°i m√† ƒëi·ªÅu g√¨ ƒë√≥ x·∫£y ra ho·∫∑c c√≥ nh·ªØng s·ª± ki·ªán g·∫Øn li·ªÅn v·ªõi n√≥.
- M·ªôt ch∆∞∆°ng tr√¨nh h·ªó tr·ª£ locale l√† ch∆∞∆°ng tr√¨nh t√¥n tr·ªçng s·ª± l·ª±a ch·ªçn d·ª±a tr√™n n·ªÅn t·∫£ng vƒÉn ho√° c·ªßa ng∆∞·ªùi d√πng, nh∆∞ b·∫£ng ch·ªØ c√°i, c√°ch s·∫Øp x·∫øp v√† c√°ch vi·∫øt s·ªë (ng∆∞·ªùi Vi·ªát Nam th∆∞·ªùng d√πng d·∫•u `,` trong s·ªë th·ª±c: 1,5. Ng∆∞·ªùi ch√¢u M·ªπ l·∫°i d√πng d·∫•u `.`: 1.5)
(D·ªãch theo [t√†i li·ªáu c·ªßa Postgresql](https://www.postgresql.org/docs/9.3/static/locale.html))
- M·ªôt locale l√† m·ªôt b·ªô lu·∫≠t ng√¥n ng·ªØ v√† vƒÉn ho√°. (theo [manpage c·ªßa Ubuntu](http://manpages.ubuntu.com/manpages/xenial/en/man7/locale.7.html))

Locale kh√¥ng ch·ªâ l√† kh√°i ni·ªám c·ªßa ri√™ng ng√¥n ng·ªØ l·∫≠p tr√¨nh n√†o m√† ƒë√≤i h·ªèi l√† h·ªó tr·ª£ c·ªßa to√†n h·ªá th·ªëng. C√°c h·ªá ƒëi·ªÅu h√†nh (OS) ƒë·ªÅu h·ªó tr·ª£ ƒë·∫∑t c√°c v√† s·ª≠ d·ª•ng locale kh√°c nhau.

### C√°ch bi·ªÉu di·ªÖn m·ªôt locale
M·ªôt locale th∆∞·ªùng ƒë∆∞·ª£c bi·ªÉu di·ªÖn ·ªü d·∫°ng "ng√¥nng·ªØ_qu·ªëcgia":
- `en_US` (U.S. English)
- `fr_CA` (French Canadian)
- `vi_VN` (Vietnamese Vietnam)

Tr√™n h·∫ßu h·∫øt c√°c h·ªát th·ªëng UNIX (Ubuntu, OSX ...), c√≥ th·ªÉ li·ªát k√™ c√°c locale ƒëang h·ªó tr·ª£ tr√™n m√°y b·∫±ng l·ªánh `locale -a`:

```bash
$ locale -a | head -n3
C
C.UTF-8
en_AG
$ locale -a | tail -n3
POSIX
vi_VN
vi_VN.utf8
```

C√°c locale c√≥ th·ªÉ ƒë∆∞·ª£c c√†i th√™m, v√≠ d·ª• tr√™n Ubuntu 16.04, locale Vi·ªát Nam kh√¥ng ƒë∆∞·ª£c c√†i s·∫µn, ph·∫£i c√†i th√™m package `language-pack-vi` ƒë·ªÉ c√≥ locale vi_VN:

```bash
apt-get install -y language-pack-vi
```

N·∫øu c√≥ nhi·ªÅu h∆°n m·ªôt b·ªô k√Ω t·ª± cho m·ªôt locale, c√≥ th·ªÉ ch·ªâ r√µ ra n√≥ ·ªü d·∫°ng: "ng√¥nng·ªØ_qu·ªëcgia.b·ªôk√Ωt·ª±": V√≠ d·ª•:

- vi_VN.tcvn (Ti√™u chu·∫©n Vi·ªát Nam, hay VNS)
- vi_VN.utf8
- vi_VN.vscii (Cho ngang ng·ª≠a v·ªõi ASCII c·ªßa M·ªπ üòú)

Danh s√°ch [m·ªôt s·ªë locale ph·ªï bi·∫øn h·ªó tr·ª£ b·ªüi GCC](https://gcc.gnu.org/onlinedocs/libstdc++/manual/localization.html), hay [danh s√°ch ƒë·∫ßy ƒë·ªß c·ªßa OS](https://opensource.apple.com/source/X11libs/X11libs-17.6/libX11/libX11-1.1.5/nls/locale.alias.pre.auto.html), hay [trong code c·ªßa module `locale` c·ªßa CPython](https://github.com/python/cpython/blob/3.6/Lib/locale.py#L1354)

Khi kh√¥ng c√≥ locale n√†o ƒë∆∞·ª£c set, locale m·∫∑c ƒë·ªãnh l√† C hay POSIX.

## Locale categories

ƒê√¥i khi, ng∆∞·ªùi ta l·∫°i mu·ªën d√πng b·∫£ng ch·ªØ c√°i c·ªßa Vi·ªát Nam, nh∆∞ng ƒë∆°n v·ªã ti·ªÅn t·ªá c·ªßa M·ªπ, th·ªùi gian theo format c·ªßa Anh, nh·ªØng nhu c·∫ßu l·∫´n l·ªôn n√†y ƒë∆∞·ª£c ƒë√°p ·ª©ng b·ªüi locale s·∫Ω chia nh·ªè th√†nh "locale subcategories" v√† m·ªói category s·∫Ω ƒëi·ªÅu ch·ªânh m·ªôt kh√≠a c·∫°nh c·ªßa lu·∫≠t locale:

- LC_COLLATE: th·ª© t·ª± s·∫Øp x·∫øp string /k…ôÀàle…™t/, ·∫£nh h∆∞·ªüng ƒë·∫øn c√°c function strcoll, strxfrm
- LC_CTYPE: ph√¢n nh√≥m ch·ªØ c√°i (ƒë√¢u l√† m·ªôt ch·ªØ c√°i, ch·ªØ c√°i d√πng 1byte hay nhi·ªÅu bytes? ch·ªØ vi·∫øt hoa t∆∞∆°ng ·ª©ng c·ªßa m·ªói ch·ªØ l√† ch·ªØ n√†o?)
- LC_MESSAGES: ng√¥n ng·ªØ c·ªßa message
- LC_MONETARY: format (ƒë·ªãnh d·∫°ng) c·ªßa ti·ªÅn
- LC_NUMERIC: format c·ªßa s·ªë
- LC_TIME: format c·ªßa ng√†y th√°ng
- LC_TELEPHONE: format s·ªë ƒëi·ªán tho·∫°i
- ... c√≤n nhi·ªÅu
- LANG: default cho c√°c LC_*
- LC_ALL: t·∫•t c·∫£ c√°c category n√≥i tr√™n.

## Th·ª© t·ª± x·ª≠ l√Ω locale
C√°c locale category th∆∞·ªùng ƒë∆∞·ª£c set l√†m bi·∫øn m√¥i tr∆∞·ªùng.

- N·∫øu `LANG` kh√¥ng null th√¨ gi√° tr·ªã c·ªßa LANG ƒë∆∞·ª£c s·ª≠ d·ª•ng l√†m default cho t·∫•t c·∫£ c√°c gi√° tr·ªã kh√¥ng ƒë∆∞·ª£c set / null kh√°c.
- N·∫øu `LC_ALL` ƒë∆∞·ª£c set, kh√¥ng null, th√¨ gi√° tr·ªã c·ªßa LC_ALL s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng, thay cho t·∫•t c·∫£ c√°c gi√° tr·ªã kh√°c.
- N·∫øu bi·∫øn n√†o ƒë∆∞·ª£c set kh√¥ng null th√¨ bi·∫øn ƒë√≥ ƒë∆∞·ª£c s·ª≠ d·ª•ng.
V·∫≠y m·ª©c ∆∞u ti√™n l√†: `LC_ALL > LC_* > LANG`

Theo  http://manpages.ubuntu.com/manpages/xenial/en/man1/locale.1posix.html

## Set/get locale tr√™n Python

```python
In [1]: import locale

In [3]: locale.getlocale(category=locale.LC_CTYPE) # LC_TYPE l√† category m·∫∑c ƒë·ªãnh
Out[3]: ('en_US', 'UTF-8')

In [4]: locale.getlocale()
Out[4]: ('en_US', 'UTF-8')

In [5]: locale.setlocale(locale.LC_ALL, 'vi_VN')
----------------------------------------------------------------------------
Error                                     Traceback (most recent call last)
<ipython-input-5-7ee8baa2ff04> in <module>()
----> 1 locale.setlocale(locale.LC_ALL, 'vi_VN')

/Users/hvn/python3/lib/python3.5/locale.py in setlocale(category, locale)
    593         # convert to string
    594         locale = normalize(_build_localename(locale))
--> 595     return _setlocale(category, locale)
    596
    597 def resetlocale(category=LC_ALL):

Error: unsupported locale setting
# Do m√°y kh√¥ng c√≥ locale vi_VN

# set locale cho t·∫•t c·∫£ category s·ª≠ d·ª•ng gi√° tr·ªã m·∫∑c ƒë·ªãnh (th∆∞·ªùng l·∫•y trong bi·∫øn m√¥i tr∆∞·ªùng LANG)
In [6]: locale.setlocale(locale.LC_ALL, '')
Out[6]: 'en_US.UTF-8'

# Tr·∫£ v·ªÅ database c·ªßa c√°c convention hi·ªán t·∫°i
In [7]: locale.localeconv()
Out[7]:
{'currency_symbol': '$',
 'decimal_point': '.',
 'frac_digits': 2,
 'grouping': [3, 3, 0],
 'int_curr_symbol': 'USD ',
 'int_frac_digits': 2,
 'mon_decimal_point': '.',
 'mon_grouping': [3, 3, 0],
 'mon_thousands_sep': ',',
 'n_cs_precedes': 1,
 'n_sep_by_space': 0,
 'n_sign_posn': 1,
 'negative_sign': '-',
 'p_cs_precedes': 1,
 'p_sep_by_space': 0,
 'p_sign_posn': 1,
 'positive_sign': '',
 'thousands_sep': ','}

# ƒê·ªïi locale sang C, ·ªü locale n√†y kh√¥ng c√≥ ƒë∆°n v·ªã ti·ªÅn t·ªá.
In [15]: locale.setlocale(locale.LC_ALL, 'C'); locale.localeconv()['currency_symbol']
Out[15]: ''

# Khi ƒë·ªïi l·∫°i v·ªÅ locale default (th∆∞·ªùng l·∫•y t·ª´ LANG), ·ªü ƒë√¢y l√† en_US.UTF8, k√Ω hi·ªáu ƒë∆°n v·ªã ti·ªÅn t·ªá l√† $.
In [16]: locale.setlocale(locale.LC_ALL, ''); locale.localeconv()['currency_symbol']
Out[16]: '$'
```

Tr√™n m·ªôt m√°y c√≥ locale vi_VN, c√≥ th·ªÉ thay ƒë·ªïi v√† xem ƒë∆°n v·ªã ti·ªÅn t·ªá:

```python
In [2]: locale.setlocale(locale.LC_ALL, 'vi_VN')
Out[2]: 'vi_VN'

In [3]: locale.localeconv()
Out[3]:
{'currency_symbol': '‚Ç´',
 'decimal_point': ',',
 'frac_digits': 0,
 'grouping': [3, 3, 0],
 'int_curr_symbol': 'VND ',
 'int_frac_digits': 0,
 'mon_decimal_point': ',',
 'mon_grouping': [3, 3, 0],
 'mon_thousands_sep': '.',
 'n_cs_precedes': 1,
 'n_sep_by_space': 0,
 'n_sign_posn': 1,
 'negative_sign': '-',
 'p_cs_precedes': 0,
 'p_sep_by_space': 0,
 'p_sign_posn': 1,
 'positive_sign': '',
 'thousands_sep': '.'}
 ```

Ch√∫ √Ω vi·ªác set n√†y ch·ªâ c√≥ t√°c d·ª•ng t·∫°i phi√™n l√†m vi·ªác hi·ªán th·ªùi. ƒê·ªÉ thay ƒë·ªïi locale c·ªßa to√†n h·ªá th·ªëng (Ubuntu), ph·∫£i thay ƒë·ªïi trong `/etc/default/locale`

```bash
root@hvn:~# cat /etc/default/locale
LANG="en_US.UTF-8"
```

r·ªìi ch·∫°y `locale-gen`.

## S·∫Øp x·∫øp string theo ki·ªÉu Vi·ªát Nam

N·∫øu ƒë√£ ƒë·ªçc ƒë·∫øn ƒë√¢y v√† hi·ªÉu nh·ªØng g√¨ vi·∫øt trong b√†i th√¨ b·∫°n s·∫Ω bi·∫øt r·∫±ng th·ª© t·ª± c√°c ch·ªØ c√°i khi s·∫Øp x·∫øp ph·ª• thu·ªôc v√†o locale category: `LC_COLLATE`

```python
In [1]: import locale

In [2]: locale.getlocale()
Out[2]: ('en_US', 'UTF-8')

In [3]: provinces = ['H·∫£i D∆∞∆°ng',
   ...:     ...:  'H∆∞ng Y√™n',
   ...:     ...:  'H√† N·ªôi',
   ...:     ...:  'H·∫£i Ph√≤ng',
   ...:     ...:  'H·∫≠u Giang',
   ...:     ...:  'H√≤a B√¨nh',
   ...:     ...:  'H√† Nam',
   ...:     ...:  'H√† Giang',
   ...:     ...:  'H√† Tƒ©nh']

In [4]: sorted(provinces)
Out[4]:
['H√† Giang',
 'H√† Nam',
 'H√† N·ªôi',
 'H√† Tƒ©nh',
 'H√≤a B√¨nh',
 'H∆∞ng Y√™n',
 'H·∫£i D∆∞∆°ng',
 'H·∫£i Ph√≤ng',
 'H·∫≠u Giang']

In [5]: locale.setlocale(locale.LC_COLLATE, 'vi_VN')
Out[5]: 'vi_VN'

In [6]: sorted(provinces, key=locale.strxfrm)
Out[6]:
['H√† Giang',
 'H·∫£i D∆∞∆°ng',
 'H·∫£i Ph√≤ng',
 'H√† Nam',
 'H√† N·ªôi',
 'H√† Tƒ©nh',
 'H·∫≠u Giang',
 'H√≤a B√¨nh',
 'H∆∞ng Y√™n']

In [11]: locale.strxfrm?
Docstring:
strxfrm(string) -> string.

Return a string that can be used as a key for locale-aware comparisons.
Type:      builtin_function_or_method

```

Gi·ªù th√¨ H∆∞ng Y√™n ƒë√£ ƒë·ª©ng cu·ªëi list üòç.

- PS: Ch·ªçn locale l√∫c t·∫°o database l√† ƒëi·ªÅu r·∫•t quan tr·ªçng c·∫ßn ch√∫ √Ω (PostgreSQL, MySQL).
- PS2: khi ch·∫°y ch∆∞∆°ng tr√¨nh tr√™n server, nh·ªõ set locale: http://www.familug.org/2017/03/phai-set-locale-trong-upstart.html
- PS3: v·ªõi Python c√≥ th·ªÉ tham kh·∫£o s·ª≠ d·ª•ng th∆∞ vi·ªán `pyicu`

## Tham kh·∫£o
- Postgresql doc: https://www.postgresql.org/docs/9.3/static/locale.html
- Sorting howto: https://docs.python.org/3/howto/sorting.html#odd-and-ends
- Locale stdlib: https://docs.python.org/3/library/locale.html

H·∫øt.
HVN at http://www.familug.org/ and http://pymi.vn

ƒêƒÉng k√Ω h·ªçc l·∫≠p tr√¨nh #Python 3 t·ª´ con s·ªë 0 t·∫°i PyMI.vn - l·ªõp H√† N·ªôi khai gi·∫£ng m√πng 1 th√°ng 6, l·ªõp S√†i G√≤n khai gi·∫£ng ƒë·∫ßu th√°ng 8. Xem chi ti·∫øt t·∫°i https://pymi.vn/ #PyMI #PyFML
---
pub_date: 2017-06-6
---
shortintro: L√†m sao ƒë·ªÉ s·∫Øp x·∫øp cho "H∆∞ng Y√™n" ƒë·ª©ng sau "H·∫£i D∆∞∆°ng"?
---
_slug: sap-xep-tieng-viet
