title: T·ª´ 'a' ƒë·∫øn '√°' r·ªìi sang '∆∞'
---
author: HVN
---
body:

(Hay c√¢u chuy·ªán v·ªÅ encoding)

Ai t·ª´ng l√†m l·∫≠p tr√¨nh c≈©ng s·∫Ω c√≥ kh√¥ng √≠t l·∫ßn ƒëau ƒë·∫ßu v√¨ chuy·ªán "encode".

Ai l·∫≠p tr√¨nh d√πng Ti·∫øng Vi·ªát, d√π kh√¥ng hi·ªÉu c≈©ng bi·∫øt ƒë·∫øn UTF-8/Unicode.

C√≤n b√¢y gi·ªù l√† c√¢u chuy·ªán t·ª´ 'a' ƒë·∫øn '√°' r·ªìi sang '∆∞'.

## ASCII /Àà√¶ski/

M√°y t√≠nh ph√°t tri·ªÉn m·∫°nh m·∫Ω t·ª´ nh·ªØng qu·ªëc gia n√≥i ti·∫øng Anh, v√† khi c·∫ßn bi·ªÉu di·ªÖn to√†n b·ªô b·∫£ng ch·ªØ c√°i / s·ªë / k√Ω hi·ªáu c·ªßa h·ªç l√™n m√°y t√≠nh, ch·ªâ c·∫ßn < 128 k√Ω t·ª± l√† ƒë·ªß:

```
In [8]: import string

In [9]: string.ascii_letters + string.digits + string.punctuation + string.whitespace
Out[9]: 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!"#$%&\'()*+,-./:;<=>?@[\\]^_`{|}~\t\n\x0b\x0c\r '

In [10]: len(string.ascii_letters + string.digits + string.punctuation + string.whitespace)
Out[10]: 100
```

M·ªçi th·ª© tr√™n m√°y t√≠nh, cu·ªëi c√πng, ƒë·ªÅu ƒë∆∞·ª£c bi·ªÉu di·ªÖn d∆∞·ªõi d·∫°ng binary (bit 0 v√† 1). M·ªói bit c√≥ th·ªÉ bi·ªÉu di·ªÖn 2 gi√° tr·ªã (mang gi√° tr·ªã 0, ho·∫∑c 1) . V·ªõi 2 bit, ta c√≥ th·ªÉ bi·ªÉu di·ªÖn ƒë∆∞·ª£c 2*2 = 4 gi√° tr·ªã kh√°c nhau. V√† ƒë·ªÉ bi·ªÉu di·ªÖn t·∫•t c·∫£ c√°c k√Ω t·ª± n√≥i tr√™n, ta c·∫ßn

```
In [41]: for i in range(1,8):
    ...:     print(i, 2**i)
    ...:
1 2
2 4
3 8
4 16
5 32
6 64
7 128
```

7 bit v√† v·∫´n c√≤n th·ª´a ra nhi·ªÅu ch·ªó tr·ªëng.

V√† ƒë√≥ ch√≠nh l√† c√°ch ng∆∞·ªùi ta ƒë√£ bi·ªÉu di·ªÖn c√°c vƒÉn b·∫£n ti·∫øng Anh l√™n m√°y t√≠nh. N∆∞·ªõc M·ªπ chu·∫©n ho√° c√°ch l√†m n√†y th√†nh m·ªôt b·∫£ng m√£ c√≥ t√™n "ASCII" (American Standard Code for Information Interchange). Ng∆∞·ªùi Anh v√† ng∆∞·ªùi M·ªπ thi nhau ghi c√°c vƒÉn b·∫£n l√™n m√°y t√≠nh ƒë·ªÉ l∆∞u tr·ªØ. Nh∆∞ b√†i ["To Autumn" c·ªßa John Keats](https://en.wikipedia.org/wiki/To_Autumn)

>    Hedge-crickets sing; and now with treble soft

>    The red-breast whistles from a garden-croft;

>    And gathering swallows twitter in the skies.

## Latin-1

ASCII s·ªëng h·∫°nh ph√∫c ƒë∆∞·ª£c v√†i nƒÉm, cho t·ªõi khi ng∆∞·ªùi ta c·∫ßn bi·ªÉu di·ªÖn c√°c vƒÉn b·∫£n ti·∫øng ƒê·ª©c, ti·∫øng Ph√°p l√™n m√°y t√≠nh. Sau nhi·ªÅu c√°ch bi·ªÉu di·ªÖn kh√°c nhau, c√°c n∆∞·ªõc ch√¢u √Çu ƒë√£ th·ªëng nh·∫•t ƒë∆∞·ª£c c√°ch bi·ªÉu di·ªÖn b·∫£ng ch·ªØ c√°i c·ªßa m√¨nh tr√™n 8 bit, bao g·ªìm 128 (0-127) k√Ω t·ª± trong b·∫£ng ASCII, c·ªông th√™m v·ªõi c√°c k√Ω t·ª± c·ªßa c√°c n∆∞·ªõc ch√¢u √Çu, nh∆∞ ch·ªØ "√©" c·ªßa Ph√°p, ch·ªØ "√º" c·ªßa ƒê·ª©c. B·∫£ng m√£ n√†y g·ªçi l√† "latin-1", ƒë∆∞·ª£c th·ªëng nh·∫•t ·ªü ti√™u chu·∫©n <a href="https://en.wikipedia.org/wiki/Latin-1_Supplement_(Unicode_block)">ISO-8859-1</a>

> Morgenwind umfl√ºgelt

> Die beschattete Bucht,

> Und im See bespiegelt

> Sich die reifende Frucht.

[Tr√≠ch "Auf dem See" - Johann Wolfgang von Goethe](https://de.wikisource.org/wiki/Auf_dem_See)

> Demain, d√®s l'aube, √† l'heure o√π blanchit la campagne,

> Je partirai. Vois-tu, je sais que tu m'attends.

> J'irai par la for√™t, j'irai par la montagne.

> Je ne puis demeurer loin de toi plus longtemps.

[Tr√≠ch Demain d√®s l'aube - Victor Hugo](https://en.wikipedia.org/wiki/Demain_d%C3%A8s_l'aube)

Xem th·ª© t·ª± c·ªßa c√°c k√Ω t·ª± trong b·∫£ng m√£ ASCII/Latin-1:

```
In [4]: ord('√†'), ord('√π'), ord('√™'), ord('√©'), ord('√®'), ord('√Æ'), ord('√¢'), ord('√ß')
Out[4]: (224, 249, 234, 233, 232, 238, 226, 231)
```

## Binary, bit, byte, hex

Trong b·ªô m√¥n khoa h·ªçc m√°y t√≠nh, 8 bit = 1 byte. C√°ch bi·ªÉu di·ªÖn 1 byte theo ti√™u chu·∫©n l√† d√πng d√£y binary c√°c bit (h·ªá nh·ªã ph√¢n):

```
In [43]: bin(128)
Out[43]: '0b10000000'
```

Th·∫ø nh∆∞ng nh∆∞ v·∫≠y l√† qu√° d√†i, n√™n ng∆∞·ªùi ta d√πng h·ªá 16 (hex) ƒë·ªÉ bi·ªÉu di·ªÖn cho ng·∫Øn. V·ªõi hex, m·ªçi k√Ω t·ª± trong b·∫£ng m√£ latin-1 ƒë·ªÅu c√≥ th·ªÉ bi·ªÉu di·ªÖn b·∫±ng 2 k√Ω t·ª±:

```
In [47]: hex(128), hex(255), hex(29)
Out[47]: ('0x80', '0xff', '0x1d')
```

0x l√† k√Ω hi·ªáu ƒë·ªÉ Python hi·ªÉu ƒë√≥ l√† h·ªá 16, khi c·∫ßn ph√¢n bi·ªát v·ªõi h·ªá 10, h·ªá 8 (0o), h·ªá 2(0b). C√≤n khi bi·∫øt ƒë√≥ l√† h·ªá 16 r·ªìi, ta ch·ªâ c·∫ßn 2 k√Ω t·ª± nh∆∞: fe (254) ff (255) ...

```
In [57]: int('0xfe', base=16), int('0xff', base=16)
Out[57]: (254, 255)

In [58]: int('fe', base=16), int('ff', base=16)
Out[58]: (254, 255)

In [1]: ord('√º'), hex(252)
Out[1]: (252, '0xfc')

In [8]: print(u'\xfc')
√º
```

## Vi·ªát Nam v√† Unicode

Ng√†y v·∫´n tr√¥i qua √™m ƒë·ªÅm, cho t·ªõi m·ªôt h√¥m, ng∆∞·ªùi ta nh·∫≠n ra c·∫ßn ph·∫£i bi·ªÉu di·ªÖn ti·∫øng Vi·ªát l√™n m√°y t√≠nh ƒë·ªÉ c√≤n ph√°t t√°n Truy·ªán Ki·ªÅu c·ªßa Nguy·ªÖn Du, ch√©p th∆° "T√¥i y√™u em" b·∫±ng ti·∫øng Nga c·ªßa Puskin, "Tam qu·ªëc ch√≠" c·ªßa La Qu√°n Trung ti·∫øng T√†u, hay "R·ª´ng Na Uy" ti·∫øng Nh·∫≠t... Nhu c·∫ßu sinh ra m·ªôt b·∫£ng m√£ cho to√†n th·∫ø gi·ªõi b√πng n·ªï. C√°c nh√† khoa h·ªçc m√°y t√≠nh ƒë√£ ng·ªìi l·∫°i v√† nghƒ© ra m·ªôt b·∫£ng m√£ cu·ªëi c√πng cho v≈© tr·ª•: Unicode.
B·∫£ng m√£ n√†y sinh ra v·ªõi m·ª•c ƒë√≠ch ghi l·∫°i t·∫•t c·∫£ c√°c k√Ω t·ª± trong v≈© tr·ª•, ng√†y nay n√≥ ƒë√£ ch·ª©a c·∫£ nh·ªØng "bi·ªÉu t∆∞·ª£ng c·∫£m x√∫c", nh∆∞ üòÇ (ƒë√¢y kh√¥ng ph·∫£i 1 b·ª©c ·∫£nh nh·ªè, b·∫°n c√≥ th·ªÉ copy/paste n√≥ tho·∫£i m√°i).

V·ªõi nh·ªØng k√Ω t·ª± ngo√†i kho·∫£ng 0-255, t·ª©c kh√¥ng th·ªÉ bi·ªÉu di·ªÖn v·ªõi 1 byte, ng∆∞·ªùi ta ph·∫£i d√πng nhi·ªÅu byte ƒë·ªÉ bi·ªÉu di·ªÖn 1 k√Ω t·ª±.

```
In [63]: ord('·ª©')
Out[63]: 7913
```
K√≠ t·ª± n√†y c√≥ th·ª© t·ª± / Codepoint 7913 trong b·∫£ng m√£ Unicode.

```
In [20]: ord('üòÇ')
Out[20]: 128514
```

B·∫£ng m√£ Unicode b·∫Øt ƒë·∫ßu b·∫±ng c√°c k√Ω t·ª± trong b·∫£ng m√£ ASCII, r·ªìi c√°c k√Ω t·ª± c√≥ th√™m trong b·∫£ng m√£ "latin-1", sau ƒë√≥ l√† c√°c b·∫£ng m√£ kh√°c. Ch·ªØ "a" d√π trong ASCII hay Unicode ƒë·ªÅu c√≥ th·ª© t·ª± l√†

```
In [64]: ord('a')
Out[64]: 97
```

B√†i th∆° ti·∫øng Nga n·ªïi ti·∫øng:

> –Ø –≤–∞—Å –ª—é–±–∏–ª: –ª—é–±–æ–≤—å –µ—â–µ –±—ã—Ç—å –º–æ–∂–µ—Ç

> –í –¥—É—à–µ –º–æ–µ–π —É–≥–∞—Å–ª–∞ –Ω–µ —Å–æ–≤—Å–µ–º;

> –ù–æ –ø—É—Å—Ç—å –æ–Ω–∞ –≤–∞—Å –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–≤–æ–∂–∏—Ç;

> –Ø –Ω–µ —Ö–æ—á—É –ø–µ—á–∞–ª–∏—Ç—å –≤–∞—Å –Ω–∏—á–µ–º.

<a href="https://en.wikipedia.org/wiki/I_Loved_You_(poem)">–Ø –≤–∞—Å –ª—é–±–∏–ª - Puskin</a>

```
In [19]: for c in title:
    ...:     print('%s:%s' % (c, ord(c)), end=' ')
    ...:
    ...:
–Ø:1071  :32 –≤:1074 –∞:1072 —Å:1089  :32 –ª:1083 —é:1102 –±:1073 –∏:1080 –ª:1083
```

T·ª´ Python3, Python ch·ªâ c√≥ 1 ki·ªÉu str v√† n√≥ m·∫∑c ƒë·ªãnh s·ª≠ d·ª•ng UTF-8 (t∆∞∆°ng ƒë∆∞∆°ng v·ªõi ki·ªÉu Unicode trong Python2).

## Encode, decode

Khi bi·ªÉu di·ªÖn tr√™n m√°y t√≠nh (th√†nh c√°c byte/bit), ta c·∫ßn ch·ªçn c√°ch ƒë·ªÉ bi·ªÉu di·ªÖn nh·ªØng k√Ω t·ª± ngo√†i kho·∫£ng 0-127 (ASCII). M·ªói c√°ch bi·ªÉu di·ªÖn n√†y g·ªçi l√† m·ªôt "encoding". Encoding kh√°c nhau nh∆∞ latin-1, utf-8, ...

Ta c√≥ k√Ω t·ª±, ta "chuy·ªÉn th·ªÉ" (encode) n√≥ ƒë·ªÉ bi·ªÉu di·ªÖn th√†nh byte/bits.
Ta c√≥ byte/bits, ta "chuy·ªÉn ng∆∞·ª£c l·∫°i" (decode) n√≥ ƒë·ªÉ th√†nh c√°c k√Ω t·ª±.

Ch·ªØ '√°', c√≥ th·ª© t·ª± 225 trong b·∫£ng m√£ Unicode, khi encode th√†nh binary theo c√°c "encoding" kh√°c nhau s·∫Ω thu ƒë∆∞·ª£c c√°c byte kh√°c nhau:

```
In [68]: ord('√°')
Out[68]: 225

In [69]: '√°'.encode('latin-1')
Out[69]: b'\xe1'

In [70]: '√°'.encode('utf-8')
Out[70]: b'\xc3\xa1'
```

Hay bi·ªÉu di·ªÖn ·ªü d·∫°ng binary:

```
In [72]: bin(ord(b'\xe1'))[2:]
Out[72]: '11100001'

In [75]: '{0} {1}'.format(bin(ord(b'\xc3'))[2:], bin(ord(b'\xa1'))[2:])
Out[75]: '11000011 10100001'
```

latin-1 bi·ªÉu di·ªÖn ch·ªØ '√°' b·∫±ng 1 byte, utf-8 bi·ªÉu di·ªÖn ch·ªØ '√°' b·∫±ng 2 byte.

Latin-1 ch·ªâ bi·ªÉu di·ªÖn ƒë∆∞·ª£c c√°c k√Ω t·ª± trong kho·∫£ng 0-255 (00-ff), m·ªói k√Ω t·ª± ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng 1 byte.

Lu·∫≠t encoding utf-8 d√πng 1 byte ƒë·ªÉ bi·ªÉu di·ªÖn c√°c k√Ω t·ª± trong kho·∫£ng 0-127, d√πng 2 ƒë·∫øn 4 bytes ƒë·ªÉ bi·ªÉu di·ªÖn k√Ω t·ª± c√≥ codepoint 128 tr·ªü l√™n (0x80), v√† c√°c byte (trong 2-4 byte) ƒë√≥ lu√¥n c√≥ gi√° tr·ªã >= 128 (0x80).

N·∫øu 1 file s·ª≠ d·ª•ng encode latin-1 ƒë·ªÉ ch·ª©a ch·ªØ "√©", t·ª©c ƒë√£ l∆∞u 1 n√≥ th√†nh 1 byte tr√™n file.
 Khi ƒë·ªçc v√†o s·ª≠ d·ª•ng encoding utf-8, ta g·∫∑p exception:

```
In [29]: with open('latin1.txt', 'w', encoding='latin1') as f:
    ...:     f.write('√©')
    ...:

In [31]: f = open('latin1.txt')

In [32]: f.read()
----------------------------------------------------------------------------
UnicodeDecodeError                        Traceback (most recent call last)
<ipython-input-32-bacd0e0f09a3> in <module>()
----> 1 f.read()

/Users/hvn/python3/lib/python3.5/codecs.py in decode(self, input, final)
    319         # decode input (taking the buffer into account)
    320         data = self.buffer + input
--> 321         (result, consumed) = self._buffer_decode(data, self.errors, final)
    322         # keep undecoded input until the next call
    323         self.buffer = data[consumed:]

UnicodeDecodeError: 'utf-8' codec can't decode byte 0xe9 in position 0: unexpected end of data

In [8]: 0xe9
Out[8]: 233

In [9]: chr(233)
Out[9]: '√©'
```

N·∫øu ta ƒë·ªçc file ƒë√≥ v√†o python ·ªü d·∫°ng binary, tr√™n Python3 ta d√πng ki·ªÉu d·ªØ li·ªáu `bytes` ƒë·ªÉ l∆∞u tr∆∞:

```
In [40]: open('latin1.txt', 'rb').read()
Out[40]: b'\xe9'

In [41]: type(b'\xe9')
Out[41]: bytes
```

Th·ª≠ ghi ch·ªØ `√©` ra file s·ª≠ d·ª•ng encoding UTF-8 (d·∫°ng Unicode ph·ªï bi·∫øn nh·∫•t, m·∫∑c ƒë·ªãnh trong Python khi ƒë·ªçc ghi file):

```
In [34]: with open('unicode.txt', 'w', encoding='utf-8') as f: # kh√¥ng c·∫ßn thi·∫øt ghi encoding='utf-8' - v√¨ l√† m·∫∑c ƒë·ªãnh r·ªìi
    ...:     f.write('√©')
    ...:

In [43]: open('unicode.txt', 'rb').read()
Out[43]: b'\xc3\xa9'
```

V√¨ '√©' khi bi·ªÉu di·ªÖn ·ªü encoding "latin-1" l√† 1 byte, v√† n·∫±m trong kho·∫£ng 0-255, d·ªÖ th·∫•y n√≥ c√≥ v·∫ª d√πng encoding latin-1, b·ªüi v·ªõi utf-8, m·ªçi gi√° tr·ªã ngo√†i kho·∫£ng 0-127 s·∫Ω ƒë∆∞·ª£c bi·ªÉu di·ªÖn b·∫±ng 2 byte tr·ªü l√™n, v√† m·ªói byte trong 2 byte ƒë√≥ ph·∫£i tho·∫£ m√£n 128 <= x <= 255.

D√πng method `decode` c·ªßa ki·ªÉu `bytes` v√† `encode` c·ªßa ki·ªÉu `str` ƒë·ªÉ chuy·ªÉn qua l·∫°i gi·ªØa 2 ki·ªÉu:

```
In [44]: n = 'Anh H∆∞ng'

In [45]: n_bytes = n.encode()

In [47]: n_bytes
Out[47]: b'Anh H\xc6\xb0ng'

In [48]: print(n_bytes.decode('utf-8')) # kh√¥ng c·∫ßn ghi utf-8 v√¨ l√† m·∫∑c ƒë·ªãnh.
Anh H∆∞ng
```

## T·ªïng k·∫øt
- B·∫£ng m√£ ASCII d√πng ƒë·ªÉ l∆∞u tr·ªØ c√°c k√Ω t·ª± ti·∫øng Anh/M·ªπ, s·ª≠ d·ª•ng 7 bits c√≥ kh·∫£ nƒÉng l∆∞u tr·ªØ 2**7 = 128 k√Ω t·ª±
- B·∫£ng m√£ Latin-1 m·ªü r·ªông b·∫£ng m√£ ASCII, s·ª≠ d·ª•ng 8 bits, c√≥ kh·∫£ nƒÉng l∆∞u tr·ªØ 2**8 = 256 k√Ω t·ª±.
- B·∫£ng m√£ Unicode v·ªõi encoding UTF-8 ƒë∆∞·ª£c s·ª≠ d·ª•ng r·ªông r√£i, c√≥ kh·∫£ nƒÉng l∆∞u tr·ªØ m·ªçi k√Ω t·ª± trong v≈© tr·ª•. ƒê∆∞·ª£c thi·∫øt k·∫ø t∆∞∆°ng th√≠ch v·ªõi Latin-1 v√† ASCII khi ch·ªâ d√πng 1 byte l∆∞u tr·ªØ nh·ªØng k√Ω t·ª± trong hai b·∫£ng m√£ n√†y.
- C√°c function: ord, chr gi√∫p hi·ªÉn th·ªã th·ª© t·ª± c·ªßa k√Ω t·ª± trong b·∫£ng m√£ Unicode / h√¨nh ·∫£nh c·ªßa n√≥.
- Ki·ªÉu d·ªØ li·ªáu `bytes` trong Python3 c√≥ kh·∫£ nƒÉng l∆∞u tr·ªØ bytes ·ªü d·∫°ng "th√¥".
- Encode chuy·ªÉn t·ª´ vƒÉn b·∫£n v·ªÅ d·∫°ng binary.
- Decode ƒë·ªÉ chuy·ªÉn t·ª´ d·∫°ng binary th√†nh d·∫°ng text.
- D√πng m√£ Hex (h·ªá 16) d√πng ƒë·ªÉ hi·ªÉn th·ªã c√°c byte ng·∫Øn g·ªçn v·ªõi 2 k√Ω t·ª± cho 1 byte.

## Tham kh·∫£o
- https://en.wikipedia.org/wiki/ASCII#Variants_and_derivations
- https://docs.python.org/3/howto/unicode.html
---
pub_date: 2017-04-18
---
shortintro:

Unicode, decode, encode string trong Python
